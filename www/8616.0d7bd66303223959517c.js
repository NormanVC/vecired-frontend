(self.webpackChunkveciRed=self.webpackChunkveciRed||[]).push([[8616],{5369:(e,o,i)=>{"use strict";i.d(o,{r:()=>c});var t=i(8583),r=i(7823),a=i(5503),n=i(665),s=i(639);let c=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[t.ez,r.Pc,a.D,n.u5]]}),e})()},8616:(e,o,i)=>{"use strict";i.r(o),i.d(o,{AcuerdosPageModule:()=>P});var t=i(8583),r=i(665),a=i(7823),n=i(7860),s=i(639),c=i(6014),d=i(4762),u=i(2478),l=i(9859);const h=i(2340).N.url;let g=(()=>{class e{transform(e,o){return`${h}/acuerdos/imagenAcuerdo/${o}/${e}`}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275pipe=s.Yjl({name:"imagenAcuerdo",type:e,pure:!0}),e})();function m(e,o){if(1&e&&(s._UZ(0,"img",23),s.ALo(1,"imagenAcuerdo")),2&e){const e=s.oxw();s.s9C("src",s.xi3(1,1,e.acuerdoPublicado.imagenAcuerdo[0],e.acuerdoPublicado.usuario._id),s.LSH)}}let p=(()=>{class e{constructor(e,o,i,t){this.acuerdosService=e,this.navCtrl=o,this.alertasService=i,this.pushService=t,this.acuerdoPublicado={titulo:"",descripcion:"",fecha:null,hora:null,duracion:null,imagenAcuerdo:[],opciones:{},comunidad:{},usuario:{}},this.ocultar=!0,this.fechaFormateada=null}ngOnInit(){1==this.acuerdoPublicado.estado?this.ocultar=!0:2==this.acuerdoPublicado.estado&&(this.ocultar=!1),this.formatearFecha()}abrirEditar(){this.acuerdosService.enviarDatos(this.acuerdoPublicado,!0),this.navCtrl.navigateRoot("/main/tabs/editar-acuerdo")}eliminar(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.alertasService.alertaDecision("\xbfDesea eliminar este acuerdo?").then(e=>{!0===e.data&&(this.acuerdoPublicado.estado=0,this.acuerdosService.eliminarAcuerdo(this.acuerdoPublicado),this.alertasService.presentToast("Votaci\xf3n eliminada exitosamente"))})})}lanzarVotacion(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.alertasService.alertaDecision("\xbfDesea dar comienzo a esta votaci\xf3n?").then(e=>{if(!0===e.data){var o=(new Date).getTime();this.acuerdoPublicado.fechaLanzada=o,this.acuerdoPublicado.estado=2,this.acuerdosService.eliminarAcuerdo(this.acuerdoPublicado),this.alertasService.presentToast("Votaci\xf3n lanzada exitosamente"),this.pushService.enviarNotificacion(this.acuerdoPublicado.titulo,this.acuerdoPublicado.descripcion)}})})}terminar(){return(0,d.mG)(this,void 0,void 0,function*(){yield this.alertasService.alertaDecision("\xbfDesea que se de termino a la votaci\xf3n?").then(e=>{!0===e.data&&(this.acuerdoPublicado.estado=3,this.acuerdosService.eliminarAcuerdo(this.acuerdoPublicado),this.alertasService.presentToast("Votaci\xf3n terminada exitosamente"))})})}formatearFecha(){const e=new t.uU("en-US");var o=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"][new Date(this.acuerdoPublicado.fecha).getUTCDay()-1];this.fechaFormateada=o+e.transform(this.acuerdoPublicado.fecha,", dd-MM-YYYY")}}return e.\u0275fac=function(o){return new(o||e)(s.Y36(c.U),s.Y36(a.SH),s.Y36(u.e),s.Y36(l._))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-acuerdo-publicado"]],inputs:{acuerdoPublicado:"acuerdoPublicado"},decls:36,vars:11,consts:[[1,"acuerdo"],["fixed",""],["size","12"],["lines","none",1,"item-background-color"],["slot","start"],[3,"src"],[1,"fontColor"],["size","11"],[1,"titulo"],[1,"ion-text-center"],["class","formatoImagen",3,"src",4,"ngIf"],["size","1"],[1,"botones"],["shape","round",1,"lanzarVotacion",3,"disabled","click"],["name","arrow-forward-circle-outline"],["shape","round",3,"disabled","click"],["name","create-outline"],[1,"botones",3,"hidden"],["shape","round",1,"eliminar",3,"click"],["name","trash-bin-outline"],["shape","round",1,"terminar",3,"click"],["name","hourglass-outline"],[1,"fechaBorde"],[1,"formatoImagen",3,"src"]],template:function(e,o){1&e&&(s.TgZ(0,"ion-card",0),s.TgZ(1,"ion-grid",1),s.TgZ(2,"ion-row"),s.TgZ(3,"ion-col",2),s.TgZ(4,"ion-item",3),s.TgZ(5,"ion-avatar",4),s._UZ(6,"img",5),s.qZA(),s.TgZ(7,"ion-label"),s.TgZ(8,"h3"),s.TgZ(9,"b"),s._uU(10),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"ion-card-content",6),s.TgZ(12,"ion-row"),s.TgZ(13,"ion-col",7),s.TgZ(14,"ion-card-title",8),s._uU(15),s.qZA(),s.TgZ(16,"div",9),s._uU(17),s.qZA(),s.YNc(18,m,2,4,"img",10),s.qZA(),s.TgZ(19,"ion-col",11),s.TgZ(20,"ion-buttons",12),s.TgZ(21,"ion-button",13),s.NdJ("click",function(){return o.lanzarVotacion()}),s._UZ(22,"ion-icon",14),s.qZA(),s.qZA(),s.TgZ(23,"ion-buttons",12),s.TgZ(24,"ion-button",15),s.NdJ("click",function(){return o.abrirEditar()}),s._UZ(25,"ion-icon",16),s.qZA(),s.qZA(),s.TgZ(26,"ion-buttons",17),s.TgZ(27,"ion-button",18),s.NdJ("click",function(){return o.eliminar()}),s._UZ(28,"ion-icon",19),s.qZA(),s.qZA(),s.TgZ(29,"ion-buttons",17),s.TgZ(30,"ion-button",20),s.NdJ("click",function(){return o.terminar()}),s._UZ(31,"ion-icon",21),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(32,"ion-row"),s.TgZ(33,"ion-col",2),s.TgZ(34,"label",22),s._uU(35),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&e&&(s.xp6(6),s.MGl("src","/assets/avatars/",o.acuerdoPublicado.usuario.imagenPerfil,"",s.LSH),s.xp6(4),s.Oqu(o.acuerdoPublicado.comunidad.nombreComunidad),s.xp6(5),s.Oqu(o.acuerdoPublicado.titulo),s.xp6(2),s.Oqu(o.acuerdoPublicado.descripcion),s.xp6(1),s.Q6J("ngIf",o.acuerdoPublicado.imagenAcuerdo.length>0),s.xp6(3),s.Q6J("disabled",!o.ocultar),s.xp6(3),s.Q6J("disabled",!o.ocultar),s.xp6(2),s.Q6J("hidden",!o.ocultar),s.xp6(3),s.Q6J("hidden",o.ocultar),s.xp6(6),s.AsE(" ",o.fechaFormateada," | ",o.acuerdoPublicado.hora," "))},directives:[a.PM,a.jY,a.Nd,a.wI,a.Ie,a.BJ,a.Q$,a.FN,a.gZ,t.O5,a.Sm,a.YG,a.gu],pipes:[g],styles:[".acuerdo[_ngcontent-%COMP%]{margin-top:10px;box-shadow:0 0 2em rgba(30,30,31,.932);background-color:#5bf00440}.titulo[_ngcontent-%COMP%]{color:#000;text-align:center;margin-bottom:1em}.imagen[_ngcontent-%COMP%]{width:100%;border:2px solid #241816}.fechaBorde[_ngcontent-%COMP%]{padding:5px;border:2px solid #424242;border-radius:5px}.fontColor[_ngcontent-%COMP%]{color:#000}.item-background-color[_ngcontent-%COMP%]{--ion-item-background:#0000}.formatoImagen[_ngcontent-%COMP%]{width:100%;height:250px;border:2px solid #241816}"]}),e})();function b(e,o){if(1&e&&(s.TgZ(0,"ion-col",2),s._UZ(1,"app-acuerdo-publicado",3),s.qZA()),2&e){const e=o.$implicit;s.xp6(1),s.Q6J("acuerdoPublicado",e)}}let f=(()=>{class e{constructor(){this.acuerdosComunidad=[]}ngOnInit(){}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-acuerdos-comunidad"]],inputs:{acuerdosComunidad:"acuerdosComunidad"},decls:3,vars:1,consts:[["fixed",""],["size","12","size-lg","4","size-md","6","size-sm","12","size-xs","12",4,"ngFor","ngForOf"],["size","12","size-lg","4","size-md","6","size-sm","12","size-xs","12"],[3,"acuerdoPublicado"]],template:function(e,o){1&e&&(s.TgZ(0,"ion-grid",0),s.TgZ(1,"ion-row"),s.YNc(2,b,2,1,"ion-col",1),s.qZA(),s.qZA()),2&e&&(s.xp6(2),s.Q6J("ngForOf",o.acuerdosComunidad))},directives:[a.jY,a.Nd,t.sg,a.wI,p],styles:[""]}),e})();function Z(e,o){1&e&&(s.TgZ(0,"div",14),s.TgZ(1,"h3",15),s.TgZ(2,"b"),s._uU(3,"No hay acuerdos en tu comunidad"),s.qZA(),s.qZA(),s._UZ(4,"img",16),s.TgZ(5,"h3",15),s.TgZ(6,"b"),s._uU(7,"\xa1Crea el primero!"),s.qZA(),s.qZA(),s.qZA())}const A=[{path:"",component:(()=>{class e{constructor(e,o){this.acuerdosService=e,this.navCtrl=o,this.acuerdos=[],this.emptyAcuerdos=!1,this.deshabilitar=!1,this.acuerdosCreadosLanzados={},this.milliSecondsInASecond=1e3,this.hoursInADay=24,this.minutesInAnHour=60,this.SecondsInAMinute=60}ngOnInit(){this.scroll(),this.acuerdosService.nuevoAcuerdo.subscribe(e=>{this.emptyAcuerdos=!1,this.acuerdos.unshift(e)}),this.acuerdosService.acuerdoEliminado.subscribe(e=>{this.refresh()})}scroll(e,o=!1){this.acuerdosService.getAcuerdos(o).subscribe(i=>{o&&(this.acuerdos=[],this.deshabilitar=!1,this.emptyAcuerdos=!1);for(let e=0;e<i.acuerdosPublicados.length;e++)1!=i.acuerdosPublicados[e].estado&&2!=i.acuerdosPublicados[e].estado||(this.acuerdosCreadosLanzados=i.acuerdosPublicados[e],2==this.acuerdosCreadosLanzados.estado&&(this.timeDifference=this.acuerdosCreadosLanzados.fechaLanzada+this.acuerdosCreadosLanzados.duracion*this.milliSecondsInASecond*this.minutesInAnHour*this.SecondsInAMinute-(new Date).getTime(),this.timeDifference<0&&(this.acuerdosCreadosLanzados.estado=3,this.acuerdosService.eliminarAcuerdo(this.acuerdosCreadosLanzados))),this.acuerdos.push(this.acuerdosCreadosLanzados));0==this.acuerdos.length&&1===i.pagina&&(this.emptyAcuerdos=!0),e&&(e.target.complete(),0===i.acuerdosPublicados.length&&(this.deshabilitar=!0))})}refresh(e){this.scroll(e,!0),this.acuerdos=[],this.deshabilitar=!1}ionViewWillEnter(){this.emptyAcuerdos=!1,this.refresh()}}return e.\u0275fac=function(o){return new(o||e)(s.Y36(c.U),s.Y36(a.SH))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-acuerdos"]],decls:20,vars:3,consts:[[1,"cabecera"],["slot","start"],["defaultHref","/main/tabs/tab1","color","light"],["color","light",1,"vecired"],["slot","end"],["shape","round","routerLink","/main/tabs/crear-acuerdo"],["slot","icon-only","name","add-outline","color","light"],["color","light"],[1,"titulo"],[1,"ion-text-center"],["slot","fixed",3,"ionRefresh"],["class","sinAcuerdos",4,"ngIf"],[3,"acuerdosComunidad"],["threshold","100px",3,"disabled","ionInfinite"],[1,"sinAcuerdos"],[1,"sinAcuerdosTitulo"],["src","/../../assets/sadHouse.png",1,"sinAcuerdosImagen"]],template:function(e,o){1&e&&(s.TgZ(0,"ion-header"),s.TgZ(1,"ion-toolbar",0),s.TgZ(2,"ion-buttons",1),s._UZ(3,"ion-back-button",2),s.qZA(),s.TgZ(4,"ion-title",3),s._uU(5,"VeciRed"),s.qZA(),s.TgZ(6,"ion-buttons",4),s.TgZ(7,"ion-button",5),s._UZ(8,"ion-icon",6),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(9,"ion-content",7),s.TgZ(10,"div",8),s.TgZ(11,"h4",9),s.TgZ(12,"b"),s._uU(13,"ACUERDOS"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(14,"ion-refresher",10),s.NdJ("ionRefresh",function(e){return o.refresh(e)}),s._UZ(15,"ion-refresher-content"),s.qZA(),s.YNc(16,Z,8,0,"div",11),s._UZ(17,"app-acuerdos-comunidad",12),s.TgZ(18,"ion-infinite-scroll",13),s.NdJ("ionInfinite",function(e){return o.scroll(e)}),s._UZ(19,"ion-infinite-scroll-content"),s.qZA(),s.qZA()),2&e&&(s.xp6(16),s.Q6J("ngIf",o.emptyAcuerdos),s.xp6(1),s.Q6J("acuerdosComunidad",o.acuerdos),s.xp6(1),s.Q6J("disabled",o.deshabilitar))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.YG,a.YI,n.rH,a.gu,a.W2,a.nJ,a.Wo,t.O5,f,a.ju,a.MB],styles:[".sinAcuerdos[_ngcontent-%COMP%]{border:2px solid #241816;border-bottom-left-radius:9%;border-bottom-right-radius:9%;border-top-left-radius:9%;border-top-right-radius:9%;box-shadow:0 0 2em rgba(30,30,31,.932);height:50%;width:90%;margin-left:5%;background-color:#afeeee}.sinAcuerdosTitulo[_ngcontent-%COMP%]{color:#000;font-family:Perpetua;text-align:center;font-family:monospace}.sinAcuerdosImagen[_ngcontent-%COMP%]{margin-left:30%;width:40%;height:50%;max-height:70%}.titulo[_ngcontent-%COMP%]{margin-top:-3%;font-family:monospace}.cabecera[_ngcontent-%COMP%]{--background:linear-gradient(135deg,#110a3b,#2f32a0)}.vecired[_ngcontent-%COMP%]{color:#f0f8ff;font-weight:bolder;font-size:x-large;text-align:center}"]}),e})()}];let v=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.Bz.forChild(A)],n.Bz]}),e})();var T=i(5369);let P=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[t.ez,r.u5,a.Pc,v,T.r]]}),e})()},5503:(e,o,i)=>{"use strict";i.d(o,{D:()=>r});var t=i(639);let r=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({}),e})()},6014:(e,o,i)=>{"use strict";i.d(o,{U:()=>u});var t=i(1841),r=i(639),a=i(2340),n=i(1929),s=i(4975),c=i(7905);const d=a.N.url;let u=(()=>{class e{constructor(e,o,i){this.http=e,this.usuarioService=o,this.fileTransfer=i,this.pagiaAcuerdos=0,this.Objeto=new n.t,this.nuevoAcuerdo=new r.vpe,this.acuerdoEliminado=new r.vpe}getAcuerdos(e=!1){e&&(this.pagiaAcuerdos=0);const o=new t.WM({UToken:this.usuarioService.userToken});return this.pagiaAcuerdos++,this.http.get(`${d}/acuerdos/?pagina=${this.pagiaAcuerdos}`,{headers:o})}crearAcuerdo(e){const o=new t.WM({UToken:this.usuarioService.userToken});return new Promise(i=>{this.http.post(`${d}/acuerdos`,e,{headers:o}).subscribe(e=>{this.nuevoAcuerdo.emit(e.acuerdo),i(!0)})})}enviarDatos(e,o){e.tipo=o,this.Objeto.next(e)}limpiar(e){this.Objeto.next(e)}actualizarAcuerdo(e){const o=new t.WM({UToken:this.usuarioService.userToken});return new Promise(i=>{this.http.post(`${d}/acuerdos/actualizar`,e,{headers:o}).subscribe(e=>{i(!!e.ok)})})}eliminarAcuerdo(e){const o=new t.WM({UToken:this.usuarioService.userToken});return new Promise(i=>{this.http.post(`${d}/acuerdos/actualizar`,e,{headers:o}).subscribe(e=>{e.ok?(this.acuerdoEliminado.emit(e.acuerdo),i(!0)):i(!1)})})}subirImagen(e){const o={fileKey:"imagenAcuerdo",headers:{UToken:this.usuarioService.userToken}};this.fileTransfer.create().upload(e,`${d}/acuerdos/upload`,o).then(e=>{console.log(e)}).catch(e=>{console.log("Fallo al subir imagen:",e)})}}return e.\u0275fac=function(o){return new(o||e)(r.LFG(t.eN),r.LFG(s.i),r.LFG(c.K))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);