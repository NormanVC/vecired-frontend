(self.webpackChunkveciRed=self.webpackChunkveciRed||[]).push([[5473],{5369:(e,o,t)=>{"use strict";t.d(o,{r:()=>c});var i=t(8583),n=t(7823),a=t(5503),r=t(665),s=t(639);let c=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[i.ez,n.Pc,a.D,r.u5]]}),e})()},5473:(e,o,t)=>{"use strict";t.r(o),t.d(o,{VotacionesPageModule:()=>b});var i=t(8583),n=t(665),a=t(7823),r=t(7860),s=t(639),c=t(6014),u=t(8320);function d(e,o){if(1&e&&(s._UZ(0,"img",14),s.ALo(1,"mostrarImagen")),2&e){const e=s.oxw();s.s9C("src",s.xi3(1,1,e.votacionPublicada.imagenAcuerdo,e.votacionPublicada.usuario._id),s.LSH)}}let l=(()=>{class e{constructor(e,o){this.acuerdosService=e,this.navCtrl=o,this.votacionPublicada={titulo:"",descripcion:"",fecha:null,hora:null,duracion:null,imagenAcuerdo:[],opciones:{},comunidad:{},usuario:{}},this.fechaFormateada=null}ngOnInit(){this.formatearFecha()}abrirVotacion(){this.acuerdosService.enviarDatos(this.votacionPublicada),this.navCtrl.navigateRoot("/main/tabs/detalle-votacion")}formatearFecha(){const e=new i.uU("en-US");var o=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"][new Date(this.votacionPublicada.fecha).getUTCDay()-1];this.fechaFormateada=o+e.transform(this.votacionPublicada.fecha,", dd-MM-YYYY")}}return e.\u0275fac=function(o){return new(o||e)(s.Y36(c.U),s.Y36(a.SH))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-votacion-publicada"]],inputs:{votacionPublicada:"votacionPublicada"},decls:26,vars:7,consts:[[1,"acuerdo"],["fixed",""],["size","12"],["lines","none",1,"item-background-color"],["slot","start"],[3,"src"],[1,"fontColor"],[1,"titulo"],[1,"ion-text-center"],["class","formatoImagen",3,"src",4,"ngIf"],["size","9",1,"itemsCenter"],[1,"fechaBorde"],["size","3"],["color","tertiary","expand","full",2,"margin-right","10%",3,"click"],[1,"formatoImagen",3,"src"]],template:function(e,o){1&e&&(s.TgZ(0,"ion-card",0),s.TgZ(1,"ion-grid",1),s.TgZ(2,"ion-row"),s.TgZ(3,"ion-col",2),s.TgZ(4,"ion-item",3),s.TgZ(5,"ion-avatar",4),s._UZ(6,"img",5),s.qZA(),s.TgZ(7,"ion-label"),s.TgZ(8,"h3"),s.TgZ(9,"b"),s._uU(10),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(11,"ion-card-content",6),s.TgZ(12,"ion-row"),s.TgZ(13,"ion-col",2),s.TgZ(14,"ion-card-title",7),s._uU(15),s.qZA(),s.TgZ(16,"div",8),s._uU(17),s.qZA(),s.YNc(18,d,2,4,"img",9),s.qZA(),s.qZA(),s.qZA(),s.TgZ(19,"ion-row"),s.TgZ(20,"ion-col",10),s.TgZ(21,"label",11),s._uU(22),s.qZA(),s.qZA(),s.TgZ(23,"ion-col",12),s.TgZ(24,"ion-button",13),s.NdJ("click",function(){return o.abrirVotacion()}),s._uU(25," Votar "),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()),2&e&&(s.xp6(6),s.MGl("src","/assets/avatars/",o.votacionPublicada.usuario.imagenPerfil,"",s.LSH),s.xp6(4),s.Oqu(o.votacionPublicada.comunidad.nombreComunidad),s.xp6(5),s.Oqu(o.votacionPublicada.titulo),s.xp6(2),s.Oqu(o.votacionPublicada.descripcion),s.xp6(1),s.Q6J("ngIf",o.votacionPublicada.imagenAcuerdo.length>0),s.xp6(4),s.AsE(" ",o.fechaFormateada," | ",o.votacionPublicada.hora," "))},directives:[a.PM,a.jY,a.Nd,a.wI,a.Ie,a.BJ,a.Q$,a.FN,a.gZ,i.O5,a.YG],pipes:[u.P],styles:[".acuerdo[_ngcontent-%COMP%]{margin-top:10px;box-shadow:0 0 2em rgba(30,30,31,.932);background-color:#5bf00440}.titulo[_ngcontent-%COMP%]{color:#000;text-align:center;margin-bottom:1em}.formatoImagen[_ngcontent-%COMP%]{width:100%;height:250px;border:2px solid #241816}.fechaBorde[_ngcontent-%COMP%]{padding:5px;border:2px solid #424242;border-radius:5px}.itemsCenter[_ngcontent-%COMP%]{display:flex;align-items:center}.item-background-color[_ngcontent-%COMP%]{--ion-item-background:#0000}.fontColor[_ngcontent-%COMP%]{color:#000}"]}),e})();function h(e,o){1&e&&(s.TgZ(0,"div",15),s.TgZ(1,"h3",16),s.TgZ(2,"b"),s._uU(3,"No se han lanzado votaciones en tu comunidad"),s.qZA(),s.qZA(),s._UZ(4,"img",17),s.qZA())}function g(e,o){if(1&e&&(s.TgZ(0,"ion-col",18),s._UZ(1,"app-votacion-publicada",19),s.qZA()),2&e){const e=o.$implicit;s.xp6(1),s.Q6J("votacionPublicada",e)}}const f=[{path:"",component:(()=>{class e{constructor(e,o){this.acuerdosService=e,this.navCtrl=o,this.acuerdos=[],this.deshabilitar=!1,this.contador=0,this.acuerdoLanzado={},this.emptyVotaciones=!1,this.milliSecondsInASecond=1e3,this.hoursInADay=24,this.minutesInAnHour=60,this.SecondsInAMinute=60}ngOnInit(){this.refresh()}scroll(e,o=!1){this.acuerdosService.getAcuerdos(o).subscribe(t=>{o&&(this.acuerdos=[],this.deshabilitar=!1,this.emptyVotaciones=!1);for(let e=0;e<t.acuerdosPublicados.length;e++)2==t.acuerdosPublicados[e].estado&&(this.acuerdoLanzado=t.acuerdosPublicados[e],this.timeDifference=this.acuerdoLanzado.fechaLanzada+this.acuerdoLanzado.duracion*this.milliSecondsInASecond*this.minutesInAnHour*this.SecondsInAMinute-(new Date).getTime(),this.timeDifference<0&&(this.acuerdoLanzado.estado=3,this.acuerdosService.eliminarAcuerdo(this.acuerdoLanzado)),this.acuerdos.push(this.acuerdoLanzado));0==this.acuerdos.length&&1===t.pagina&&(this.emptyVotaciones=!0),e&&(e.target.complete(),0===t.acuerdosPublicados.length&&(this.deshabilitar=!0))})}mostrarRegistro(){this.navCtrl.navigateRoot("/main/tabs/registros-acuerdos")}refresh(e){this.scroll(e,!0),this.acuerdos=[],this.deshabilitar=!1}ionViewWillEnter(){this.emptyVotaciones=!1,this.refresh()}}return e.\u0275fac=function(o){return new(o||e)(s.Y36(c.U),s.Y36(a.SH))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-votaciones"]],decls:25,vars:3,consts:[[1,"cabecera"],["slot","start"],["defaultHref","/main/tabs/tab1","color","light"],["color","light",1,"vecired"],["slot","end"],["disabled",""],[1,"titulo"],[1,"ion-text-center"],["slot","fixed",3,"ionRefresh"],["class","sinVotaciones",4,"ngIf"],["fixed",""],["size","12","size-lg","4","size-md","6","size-sm","12","size-xs","12",4,"ngFor","ngForOf"],["threshold","100px",3,"disabled","ionInfinite"],["vertical","bottom","slot","fixed"],["color","tertiary","expand","full","shape","round",3,"click"],[1,"sinVotaciones"],[1,"sinVotacionesTitulo"],["src","/../../assets/sadHouse.png",1,"sinVotacionesImagen"],["size","12","size-lg","4","size-md","6","size-sm","12","size-xs","12"],[3,"votacionPublicada"]],template:function(e,o){1&e&&(s.TgZ(0,"ion-header"),s.TgZ(1,"ion-toolbar",0),s.TgZ(2,"ion-buttons",1),s._UZ(3,"ion-back-button",2),s.qZA(),s.TgZ(4,"ion-title",3),s._uU(5,"VeciRed"),s.qZA(),s.TgZ(6,"ion-buttons",4),s.TgZ(7,"ion-button",5),s._UZ(8,"ion-icon"),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.TgZ(9,"ion-content"),s.TgZ(10,"div",6),s.TgZ(11,"h4",7),s.TgZ(12,"b"),s._uU(13,"VOTACIONES"),s.qZA(),s.qZA(),s.qZA(),s.TgZ(14,"ion-refresher",8),s.NdJ("ionRefresh",function(e){return o.refresh(e)}),s._UZ(15,"ion-refresher-content"),s.qZA(),s.YNc(16,h,5,0,"div",9),s.TgZ(17,"ion-grid",10),s.TgZ(18,"ion-row"),s.YNc(19,g,2,1,"ion-col",11),s.qZA(),s.qZA(),s.TgZ(20,"ion-infinite-scroll",12),s.NdJ("ionInfinite",function(e){return o.scroll(e)}),s._UZ(21,"ion-infinite-scroll-content"),s.qZA(),s.qZA(),s.TgZ(22,"ion-fab",13),s.TgZ(23,"ion-button",14),s.NdJ("click",function(){return o.mostrarRegistro()}),s._uU(24," Acuerdos anteriores "),s.qZA(),s.qZA()),2&e&&(s.xp6(16),s.Q6J("ngIf",o.emptyVotaciones),s.xp6(3),s.Q6J("ngForOf",o.acuerdos),s.xp6(1),s.Q6J("disabled",o.deshabilitar))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.YG,a.gu,a.W2,a.nJ,a.Wo,i.O5,a.jY,a.Nd,i.sg,a.ju,a.MB,a.IJ,a.wI,l],styles:[".titulo[_ngcontent-%COMP%]{margin-top:-3%;font-family:monospace}ion-fab[_ngcontent-%COMP%]{display:flex;width:100%;flex-direction:row;justify-content:center}.cabecera[_ngcontent-%COMP%]{--background:linear-gradient(135deg,#110a3b,#2f32a0)}.sinVotaciones[_ngcontent-%COMP%]{border:2px solid #241816;border-bottom-left-radius:9%;border-bottom-right-radius:9%;border-top-left-radius:9%;border-top-right-radius:9%;box-shadow:0 0 2em rgba(30,30,31,.932);height:50%;width:90%;margin-left:5%;background-color:#afeeee}.sinVotacionesTitulo[_ngcontent-%COMP%]{color:#000;font-family:Perpetua;text-align:center;font-family:monospace}.sinVotacionesImagen[_ngcontent-%COMP%]{margin-left:30%;width:40%;height:50%;max-height:70%}.vecired[_ngcontent-%COMP%]{color:#f0f8ff;font-weight:bolder;font-size:x-large;text-align:center}"]}),e})()}];let m=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[r.Bz.forChild(f)],r.Bz]}),e})();var p=t(5369);let b=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[i.ez,n.u5,a.Pc,m,p.r]]}),e})()},5503:(e,o,t)=>{"use strict";t.d(o,{D:()=>n});var i=t(639);let n=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=i.oAB({type:e}),e.\u0275inj=i.cJS({}),e})()},6014:(e,o,t)=>{"use strict";t.d(o,{U:()=>d});var i=t(1841),n=t(639),a=t(2340),r=t(1929),s=t(4975),c=t(7905);const u=a.N.url;let d=(()=>{class e{constructor(e,o,t){this.http=e,this.usuarioService=o,this.fileTransfer=t,this.pagiaAcuerdos=0,this.Objeto=new r.t,this.nuevoAcuerdo=new n.vpe,this.acuerdoEliminado=new n.vpe}getAcuerdos(e=!1){e&&(this.pagiaAcuerdos=0);const o=new i.WM({UToken:this.usuarioService.userToken});return this.pagiaAcuerdos++,this.http.get(`${u}/acuerdos/?pagina=${this.pagiaAcuerdos}`,{headers:o})}crearAcuerdo(e){const o=new i.WM({UToken:this.usuarioService.userToken});return new Promise(t=>{this.http.post(`${u}/acuerdos`,e,{headers:o}).subscribe(e=>{this.nuevoAcuerdo.emit(e.acuerdo),t(!0)})})}enviarDatos(e,o){e.tipo=o,this.Objeto.next(e)}limpiar(e){this.Objeto.next(e)}actualizarAcuerdo(e){const o=new i.WM({UToken:this.usuarioService.userToken});return new Promise(t=>{this.http.post(`${u}/acuerdos/actualizar`,e,{headers:o}).subscribe(e=>{t(!!e.ok)})})}eliminarAcuerdo(e){const o=new i.WM({UToken:this.usuarioService.userToken});return new Promise(t=>{this.http.post(`${u}/acuerdos/actualizar`,e,{headers:o}).subscribe(e=>{e.ok?(this.acuerdoEliminado.emit(e.acuerdo),t(!0)):t(!1)})})}subirImagen(e){const o={fileKey:"imagenAcuerdo",headers:{UToken:this.usuarioService.userToken}};this.fileTransfer.create().upload(e,`${u}/acuerdos/upload`,o).then(e=>{console.log(e)}).catch(e=>{console.log("Fallo al subir imagen:",e)})}}return e.\u0275fac=function(o){return new(o||e)(n.LFG(i.eN),n.LFG(s.i),n.LFG(c.K))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);